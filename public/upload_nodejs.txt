
app.post('/saveblob', upload.single('imageFile'), async (req, res) => {
  try {
    console.log('Received POST request to /saveblob');

    // Access the uploaded file via req.file
    if (!req.file) {
      console.log('No image file received.');
      return res.status(400).json({ error: 'No image file received.' });
    }

    // Get the original file name
    const originalFileName = req.file.originalname;

    // Create a unique file name for the image in Azure Blob Storage
    const fileName = `up_${originalFileName}`;

    // Create a BlobClient to upload the image to Azure Blob Storage
    const blobClient = containerClient.getBlockBlobClient(fileName);

    // Upload the file to Azure Blob Storage
    const fileData = fs.readFileSync(req.file.path);
    const uploadBlobResponse = await blobClient.uploadData(fileData);

    // Delete the local file after uploading to Azure Blob Storage
    fs.unlinkSync(req.file.path);

    console.log('File uploaded to Azure Blob Storage:', uploadBlobResponse.requestId);

    // Return the saved image URI path as a JSON response
    res.json({ savedURI: blobClient.url });
  } catch (error) {
    console.error('Error during image upload:', error.message);
    res.status(500).json({ error: 'Error during image upload.' });
  }
});
